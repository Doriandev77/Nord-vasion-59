<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nord Ã‰vasion 59 â€“ Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Inter', sans-serif; }
</style>
</head>
<body class="bg-slate-100 text-slate-800">

<!-- Header -->
<header class="bg-white sticky top-0 shadow px-8 py-4 flex justify-between items-center z-50">
  <h1 class="text-2xl font-bold text-blue-700">Nord Ã‰vasion 59</h1>
  <div class="flex items-center gap-6">
    <span class="text-slate-600">Bonjour <strong id="username"></strong> ðŸ‘‹</span>
    <button onclick="toggleCart()" class="relative text-blue-700 font-semibold">
      Panier ðŸ›’
      <span id="cartCount" class="absolute -top-2 -right-3 bg-red-600 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">0</span>
    </button>
  </div>
</header>

<!-- Hero -->
<section class="relative h-[30vh] md:h-[40vh] bg-cover bg-center"
  style="background-image:url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e');">
  <div class="absolute inset-0 bg-black/40"></div>
  <div class="relative z-10 h-full flex items-center max-w-7xl mx-auto px-8">
    <h2 class="text-white text-3xl md:text-5xl font-bold">Bienvenue <span id="usernameHero"></span> ðŸ‘‹</h2>
  </div>
</section>

<!-- Filters -->
<section class="max-w-7xl mx-auto px-8 -mt-10 relative z-20">
  <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col md:flex-row gap-4 flex-wrap items-center justify-between">
    <input id="searchInput" type="text" placeholder="Rechercher un sÃ©jour..."
      class="flex-1 border border-slate-200 rounded-lg px-4 py-3 focus:outline-none"
      oninput="renderTrips()">

    <select id="categoryFilter" class="border border-slate-200 rounded-lg px-4 py-3" onchange="renderTrips()">
      <option value="all">Toutes catÃ©gories</option>
      <option value="Mer">Mer</option>
      <option value="Montagne">Montagne</option>
      <option value="International">International</option>
      <option value="City trip">City trip</option>
    </select>

    <select id="durationFilter" class="border border-slate-200 rounded-lg px-4 py-3" onchange="renderTrips()">
      <option value="all">#Tous les sÃ©jours</option>
      <option value="journÃ©e">#JournÃ©e</option>
      <option value="long">#LongSÃ©jour</option>
    </select>
  </div>
</section>

<!-- Trips Grid -->
<section class="max-w-7xl mx-auto px-8 py-16 grid sm:grid-cols-2 lg:grid-cols-3 gap-8" id="tripList">
  <!-- Cartes voyages injectÃ©es par JS -->
</section>

<!-- Cart Modal avec rÃ©servation -->
<div id="cartModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50 overflow-auto p-6">
  <div class="bg-white w-full max-w-2xl rounded-xl p-6">
    <h3 class="text-xl font-semibold mb-4">Votre panier & rÃ©servation</h3>
    <ul id="cartItems" class="space-y-6"></ul>

    <form id="bookingForm" class="mt-6 space-y-4">
      <label class="block">
        <span class="font-medium">Email de contact</span>
        <input type="email" id="clientEmail" required
          class="w-full border border-slate-300 rounded-lg px-3 py-2 focus:outline-none">
      </label>

      <button type="submit"
        class="w-full bg-blue-700 text-white py-3 rounded-lg hover:bg-blue-800 transition">
        Envoyer mon devis
      </button>
    </form>
    <button onclick="toggleCart()" class="mt-4 w-full text-slate-600">Fermer</button>
    <div class="flex justify-between mt-6 font-bold">
      <span>Total</span>
      <span id="cartTotal">0 â‚¬</span>
    </div>
  </div>
</div>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
emailjs.init("YOUR_PUBLIC_KEY"); // Remplace par ta clÃ© EmailJS

// RÃ©cup prÃ©nom et pays
const username = localStorage.getItem("ne59_username") || "Voyageur";
const selectedCountry = localStorage.getItem("ne59_country") || null;
document.getElementById("username").textContent = username;
document.getElementById("usernameHero").textContent = username;

// Voyages complets
const trips = [
  {id:"venise", title:"Carnaval de Venise", country:"Italie", category:"International", duration:"long", dates:"11-16 fÃ©vrier", price:780, image:"https://images.unsplash.com/photo-1523906834658-6e24ef2386f9"},
  {id:"nice", title:"Carnaval de Nice & Menton", country:"France", category:"International", duration:"long", dates:"18-23 fÃ©vrier", price:765, image:"https://images.unsplash.com/photo-1502602898657-3e91760cbb34"},
  {id:"portugal", title:"DÃ©couverte du Portugal", country:"Portugal", category:"International", duration:"long", dates:"8-18 mai", price:1610, image:"https://images.unsplash.com/photo-1505761671935-60b3a7427bad"},
  {id:"vienne", title:"Vienne & Budapest", country:"Autriche", category:"International", duration:"long", dates:"27 juin-4 juil", price:1275, image:"https://images.unsplash.com/photo-1528909514045-2fa4ac7a08ba"},
  {id:"lourdes", title:"Lourdes & PyrÃ©nÃ©es", country:"France", category:"Montagne", duration:"long", dates:"26 juil-2 aoÃ»t", price:545, image:"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee"},
  {id:"versilia", title:"La Versilia â€“ CÃ´te TyrrhÃ©nienne", country:"Italie", category:"Mer", duration:"long", dates:"6-12 sept", price:855, image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb"},
  {id:"tyrol", title:"Transhumance au Tyrol", country:"Autriche", category:"Montagne", duration:"long", dates:"23-30 sept", price:1065, image:"https://images.unsplash.com/photo-1518659526055-5c148a6e1e90"},
  {id:"rome", title:"Escapade Rome, Florence et Pise", country:"Italie", category:"International", duration:"long", dates:"26 oct-1 nov", price:930, image:"https://images.unsplash.com/photo-1528909514045-2fa4ac7a08ba"},
  {id:"lille_day", title:"DÃ©couverte de Lille", country:"France", category:"City trip", duration:"journÃ©e", dates:"Samedi", price:95, image:"https://images.unsplash.com/photo-1524504388940-b1c1722653e1"},
  {id:"bruxelles_day", title:"Bruxelles express", country:"Belgique", category:"City trip", duration:"journÃ©e", dates:"Dimanche", price:110, image:"https://images.unsplash.com/photo-1518684079-01b7a62d3d43"}
];

// Panier
let cart = JSON.parse(localStorage.getItem("ne59_cart")) || [];

function saveCart() {
  localStorage.setItem("ne59_cart", JSON.stringify(cart));
  document.getElementById("cartCount").textContent = cart.length;
}

// Panier modal
function toggleCart() {
  document.getElementById("cartModal").classList.toggle("hidden");
  renderCart();
}

// Ajouter au panier
function addToCart(id) {
  const trip = trips.find(t => t.id === id);
  const exists = cart.find(item => item.id === id);
  if (!exists) {
    cart.push({...trip, qty:1, children:0});
  } else {
    exists.qty +=1;
  }
  saveCart();
  renderCart();
}

// Supprimer du panier
function removeFromCart(id) {
  cart = cart.filter(i => i.id !== id);
  saveCart();
  renderCart();
}

// Rendu du panier
function renderCart() {
  const list = document.getElementById("cartItems");
  list.innerHTML = "";
  let total = 0;
  cart.forEach(item => {
    const adults = item.qty || 1;
    const children = item.children || 0;
    total += adults*item.price + children*(item.price*0.7);
    const li = document.createElement("li");
    li.className = "bg-slate-50 p-4 rounded-lg shadow";
    li.innerHTML = `
      <div class="flex justify-between items-center">
        <span class="font-semibold">${item.title} (${item.price} â‚¬)</span>
        <button onclick="removeFromCart('${item.id}')" class="text-red-600 font-bold">âœ•</button>
      </div>
      <div class="mt-2 space-y-2">
        <label>Adultes
          <input type="number" min="1" value="${adults}" class="w-20 border px-2 py-1 rounded" onchange="item.qty = parseInt(this.value); saveCart(); renderCart();">
        </label>
        <label>Enfants
          <input type="number" min="0" value="${children}" class="w-20 border px-2 py-1 rounded" onchange="item.children = parseInt(this.value); saveCart(); renderCart();">
        </label>
      </div>
    `;
    list.appendChild(li);
  });
  document.getElementById("cartTotal").textContent = total + " â‚¬";
}

// Rendu voyages
function renderTrips() {
  const list = document.getElementById("tripList");
  list.innerHTML = "";
  const search = document.getElementById("searchInput").value.toLowerCase();
  const category = document.getElementById("categoryFilter").value;
  const duration = document.getElementById("durationFilter").value;

  trips.filter(t => 
    t.country === selectedCountry &&
    t.title.toLowerCase().includes(search) &&
    (category === "all" || t.category === category) &&
    (duration === "all" || t.duration === duration)
  ).forEach(trip => {
    const card = document.createElement("div");
    card.className = "bg-white rounded-xl shadow hover:shadow-xl transition overflow-hidden group";
    card.innerHTML = `
      <div class="h-48 bg-cover bg-center relative" style="background-image:url('${trip.image}')">
        <span class="absolute top-2 left-2 bg-blue-600 text-white text-xs px-2 py-1 rounded">${trip.duration === 'journÃ©e' ? '#JournÃ©e' : '#LongSÃ©jour'}</span>
      </div>
      <div class="p-6">
        <span class="text-sm text-blue-600 font-medium">${trip.category}</span>
        <h3 class="text-xl font-semibold mt-2">${trip.title}</h3>
        <p class="text-slate-500 text-sm mt-1">${trip.dates}</p>
        <p class="text-blue-600 font-bold mt-4">${trip.price} â‚¬</p>
        <button onclick="addToCart('${trip.id}')"
          class="mt-4 w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
          Ajouter au panier
        </button>
      </div>
    `;
    list.appendChild(card);
  });
}

// Envoi devis
document.getElementById("bookingForm").addEventListener("submit", function(e){
  e.preventDefault();
  const email = document.getElementById("clientEmail").value;

  let message = `Devis Nord Ã‰vasion 59 pour ${email}\n\n`;
  cart.forEach(item=>{
    const adults = item.qty || 1;
    const children = item.children || 0;
    message += `${item.title}\n  Adultes: ${adults}\n  Enfants: ${children}\n  Prix total: ${adults*item.price + children*(item.price*0.7)} â‚¬\n\n`;
  });

  emailjs.send("service_xxx","template_xxx",{message, to_email:"AGENCE_EMAIL@exemple.com"})
    .then(res=>alert("Devis envoyÃ© avec succÃ¨s !"))
    .catch(err=>alert("Erreur envoi: "+err));

  toggleCart();
});

// Initialisation
renderTrips();
saveCart();
</script>

</body>
</html>
