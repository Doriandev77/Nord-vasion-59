<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Les Boucles de la Lucidit√©</title>

<style>
body {
  background: #0b0b0b;
  color: #e0e0e0;
  font-family: "Georgia", serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

.game {
  width: 600px;
  max-width: 90%;
  background: #151515;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 0 30px rgba(0,0,0,0.8);
}

#story {
  font-size: 1.1em;
  line-height: 1.6;
  margin-bottom: 25px;
}

button {
  display: block;
  width: 100%;
  margin: 8px 0;
  padding: 12px;
  background: #222;
  color: #ddd;
  border: none;
  border-radius: 6px;
  font-size: 1em;
  cursor: pointer;
  transition: background 0.2s;
}

button:hover {
  background: #333;
}
</style>
</head>

<body>

<div class="game">
  <div id="story"></div>
  <div id="choices"></div>
</div>

<script>
/* ======================
   √âTAT CACH√â DU JOUEUR
====================== */
let state = {
  lucidite: 0,
  peur: 0,
  fatigue: 0,
  espoir: 1,
  memoire: 0,
  boucle: 0
};

/* ======================
   SC√àNES
====================== */
const scenes = {

  start: {
    text: "Tu ouvres les yeux.\n\nLe plafond est familier. Trop familier.\n\nTu as d√©j√† √©t√© ici.",
    choices: [
      {
        text: "Te lever imm√©diatement",
        next: "couloir",
        effect: () => state.fatigue++
      },
      {
        text: "Rester immobile et r√©fl√©chir",
        next: "souvenir",
        effect: () => state.lucidite++
      }
    ]
  },

  souvenir: {
    text: "Les souvenirs remontent par fragments.\n\nPlus tu insistes, plus ton c≈ìur s'acc√©l√®re.",
    choices: [
      {
        text: "Forcer ta m√©moire",
        next: "fracture",
        effect: () => {
          state.memoire++;
          state.peur++;
          state.lucidite++;
        }
      },
      {
        text: "Fuir ces pens√©es",
        next: "couloir",
        effect: () => state.espoir++
      }
    ]
  },

  fracture: {
    text: "Quelque chose s'est bris√© en toi.\n\nTu te souviens‚Ä¶ mais pas enti√®rement.",
    choices: [
      {
        text: "Accepter l'incompl√©tude",
        next: "couloir",
        effect: () => state.espoir--
      },
      {
        text: "Chercher plus loin",
        next: "effondrement",
        condition: () => state.memoire >= 2
      }
    ]
  },

  effondrement: {
    text: "La v√©rit√© est trop lourde.\n\nTon esprit se replie sur lui-m√™me.",
    choices: [
      {
        text: "Lutter",
        next: "mort",
        effect: () => state.peur += 2
      },
      {
        text: "L√¢cher prise",
        next: "couloir",
        effect: () => state.lucidite += 2
      }
    ]
  },

  couloir: {
    text: () => {
      if (state.lucidite >= 4) {
        return "Le couloir pulse doucement.\n\nCe lieu n'est pas r√©el.";
      }
      return "Un long couloir s'√©tend devant toi.\n\nChaque pas est lourd.";
    },
    choices: [
      {
        text: "Avancer",
        next: "porte",
        effect: () => state.fatigue++
      },
      {
        text: "T‚Äôasseoir contre le mur",
        next: "repos",
        condition: () => state.fatigue > 0
      }
    ]
  },

  repos: {
    text: "Le repos t‚Äôapaise‚Ä¶ mais quelque chose t‚Äô√©chappe.",
    choices: [
      {
        text: "Te relever",
        next: "couloir",
        effect: () => state.espoir--
      }
    ]
  },

  porte: {
    text: "Une porte noire bloque le passage.\n\nElle ne s'ouvre pas par la force.",
    choices: [
      {
        text: "Forcer la porte",
        next: "mort",
        condition: () => state.peur > 2
      },
      {
        text: "Observer attentivement",
        next: "revelation",
        condition: () => state.lucidite >= 5
      },
      {
        text: "Faire demi-tour",
        next: "boucle"
      }
    ]
  },

  revelation: {
    text: "Tu comprends enfin.\n\nCe lieu est une boucle cr√©√©e par ton refus.",
    choices: [
      {
        text: "Accepter la v√©rit√©",
        next: "finSecrete",
        condition: () => state.espoir <= 0 && state.memoire >= 2
      },
      {
        text: "Refuser",
        next: "boucle"
      }
    ]
  },

  boucle: {
    text: () => {
      state.boucle++;
      return "Tout se dissout.\n\nTu ouvres les yeux.\n\n(Boucle n¬∞ " + state.boucle + ")";
    },
    choices: [
      {
        text: "Continuer",
        next: "start"
      }
    ]
  },

  mort: {
    text: "Ton c≈ìur c√®de.\n\nLa peur a gagn√©.\n\nFIN üíÄ",
    choices: []
  },

  finSecrete: {
    text: "Tu n'as plus besoin d'espoir.\n\nLa boucle se brise.\n\nTU ES LIBRE.\n\nFIN SECR√àTE üëÅÔ∏è",
    choices: []
  }
};

/* ======================
   MOTEUR
====================== */
function showScene(id) {
  const scene = scenes[id];
  const story = document.getElementById("story");
  const choicesDiv = document.getElementById("choices");

  const text = typeof scene.text === "function"
    ? scene.text()
    : scene.text;

  story.textContent = text;
  choicesDiv.innerHTML = "";

  scene.choices.forEach(choice => {
    if (choice.condition && !choice.condition()) return;

    const btn = document.createElement("button");
    btn.textContent = choice.text;
    btn.onclick = () => {
      if (choice.effect) choice.effect();
      showScene(choice.next);
    };
    choicesDiv.appendChild(btn);
  });
}

showScene("start");
</script>

</body>
</html>
